// @ts-check
'use strict';

const { deepMergeConfig } = require('@-xun/symbiote/assets');

const {
  assertEnvironment,
  moduleExport
} = require('@-xun/symbiote/assets/babel.config.cjs');

const { createDebugLogger } = require('rejoinder');

const debug = createDebugLogger({ namespace: 'symbiote:config:babel' });

module.exports = deepMergeConfig(
  moduleExport({
    derivedAliases: getBabelAliases(),
    ...assertEnvironment({ projectRoot: __dirname })
  }),
  {
    // Any custom configs here will be deep merged with moduleExport's result
    // You may wish to enable explicit exports references for improved testing
    // DX, but be aware that it is currently a wee buggy as of 5/2025 (fix it!)
    //
    // env: {
    //   test: {
    //     plugins: ['babel-plugin-explicit-exports-references']
    //   }
    // }
  }
);

debug('exported config: %O', module.exports);

function getBabelAliases() {
  // ! These aliases are auto-generated by symbiote. Instead of modifying them
  // ! directly, consider regenerating aliases across the entire project with:
  // ! `npx symbiote project renovate --regenerate-assets --assets-preset ...`
  return {
    '^multiverse\\+api:(.+)$': './packages/api/src/$1',
    '^multiverse\\+api\\x2derror:(.+)$': './packages/api-error/src/$1',
    '^multiverse\\+api\\x2dstrategy:(.+)$': './packages/api-strategy/src/$1',
    '^multiverse\\+env:(.+)$': './packages/env/src/$1',
    '^multiverse\\+respond:(.+)$': './packages/respond/src/$1',
    '^multiverse\\+shared:(.+)$': './packages/shared/src/$1',
    '^multiverse\\+api$': './packages/api/src/index.js',
    '^multiverse\\+api\\x2derror$': './packages/api-error/src/index.js',
    '^multiverse\\+api\\x2dstrategy$': './packages/api-strategy/src/index.js',
    '^multiverse\\+env$': './packages/env/src/index.js',
    '^multiverse\\+respond$': './packages/respond/src/index.js',
    '^multiverse\\+shared$': './packages/shared/src/index.js',
    '^universe\\+api:(.+)$': './packages/api/src/$1',
    '^universe\\+api\\x2derror:(.+)$': './packages/api-error/src/$1',
    '^universe\\+api\\x2dstrategy:(.+)$': './packages/api-strategy/src/$1',
    '^universe\\+env:(.+)$': './packages/env/src/$1',
    '^universe\\+respond:(.+)$': './packages/respond/src/$1',
    '^universe\\+shared:(.+)$': './packages/shared/src/$1',
    '^universe\\+api$': './packages/api/src/index.js',
    '^universe\\+api\\x2derror$': './packages/api-error/src/index.js',
    '^universe\\+api\\x2dstrategy$': './packages/api-strategy/src/index.js',
    '^universe\\+env$': './packages/env/src/index.js',
    '^universe\\+respond$': './packages/respond/src/index.js',
    '^universe\\+shared$': './packages/shared/src/index.js',
    '^universe:(.+)$': './src/$1',
    '^universe$': './src/index.js',
    '^testverse\\+api:(.+)$': './packages/api/test/$1',
    '^testverse\\+api\\x2derror:(.+)$': './packages/api-error/test/$1',
    '^testverse\\+api\\x2dstrategy:(.+)$': './packages/api-strategy/test/$1',
    '^testverse\\+env:(.+)$': './packages/env/test/$1',
    '^testverse\\+respond:(.+)$': './packages/respond/test/$1',
    '^testverse\\+shared:(.+)$': './packages/shared/test/$1',
    '^testverse:(.+)$': './test/$1',
    '^typeverse:(.+)$': './types/$1',
    '^rootverse\\+api:(.+)$': './packages/api/$1',
    '^rootverse\\+api\\x2derror:(.+)$': './packages/api-error/$1',
    '^rootverse\\+api\\x2dstrategy:(.+)$': './packages/api-strategy/$1',
    '^rootverse\\+env:(.+)$': './packages/env/$1',
    '^rootverse\\+respond:(.+)$': './packages/respond/$1',
    '^rootverse\\+shared:(.+)$': './packages/shared/$1',
    '^rootverse:(.+)$': './$1'
  };
}
